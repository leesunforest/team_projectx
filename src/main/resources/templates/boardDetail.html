<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>게시글 상세 페이지</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/boardDetail.css">
    <link rel="stylesheet" href="/css/navigation.css">
</head>
<body>
<header>
    <h1><a href="/">중간에서 만나</a></h1>
    <div class="buttons">
        <span th:if="${session.userId}"><b th:text="${session.userId}"></b>님</span>
        <a th:if="${session.userId}" href="/logout">로그아웃</a>
        <a th:if="${session.userId == null}" href="/login">로그인</a>
    </div>
</header>
<div class="container">
    <div class="boardHeader">
        <div class="left">
            <h2 th:text="${board.boardTitle}">글 제목</h2>
        </div>
        <div class="right">
            <p th:text="'작성자: ' + ${board.boardWriter}">작성자</p>
            <p th:text="'조회수: ' + ${board.boardHits}">조회수</p>
        </div>
    </div>
    <div class="boardContents">
        <p th:text="${board.boardContents}">글 내용</p>
        <div th:if="${board.storedFileName}">
            <p>첨부파일:</p>
            <a th:href="@{|/upload/${board.storedFileName}|}" th:text="${board.originalFileName}">첨부파일 이름</a>
        </div>
    </div>
    <div class="comments">
        <h3>댓글</h3>
        <div id="comment-write">
            <input id="commentContents" type="text" placeholder="댓글 달기...">
            <button class="comment_submit" onclick="commentWrite()">게시</button>
        </div>
        <div id="comment-list" th:each="comment: ${commentList}">
            <div class="comment-item">
                <p th:text="${comment.commentWriter}">댓글 작성자</p>
                <p th:text="${comment.commentContents}">댓글 내용</p>
                <p th:text="${comment.commentCreatedTime}">댓글 작성 시간</p>
            </div>
        </div>
    </div>
    <div class="boardFooter">
        <button onclick="listReq()">목록</button>
        <button onclick="updateReq()">수정</button>
        <button onclick="deleteReq()">삭제</button>
    </div>
</div>
<footer>
    <p>© PROJECT-X JAVA TEAM 3</p>
</footer>
<script th:inline="javascript">
    const commentWrite = () => {
        const contents = document.getElementById("commentContents").value;
        console.log("내용: ", contents);
        const id = [[${board.id}]];
        $.ajax({
            type: "post",
            url: "/comment/save",
            data: {
                "commentContents": contents,
                "boardId": id
            },
            success: function (res) {
                console.log("요청성공", res);
                let newComment = `
                  <div class="comment-item">
                    <p>${res.commentWriter}</p>
                    <p>${res.commentContents}</p>
                    <p>${res.commentCreatedTime}</p>
                  </div>
                `;
                document.getElementById('comment-list').insertAdjacentHTML('beforeend', newComment);

                document.getElementById('commentWriter').value = '';
                document.getElementById('commentContents').value = '';
            },
            error: function (err) {
                console.log("요청실패", err);
            }
        });
    }
    const listReq = () => {
        console.log("목록 요청");
        const page = [[${page}]];
        location.href = "/board/paging?page="+page;
    }
    const updateReq = () => {
        console.log("수정 요청");
        const id = [[${board.id}]];
        location.href = "/board/update/" + id;
    }
    const deleteReq = () => {
        console.log("삭제 요청");
        const id = [[${board.id}]];
        location.href = "/board/delete/" + id;
    }
</script>
</body>
</html>